<!DOCTYPE html>
<html>
<head><title>KMeans Clustering</title></head>
<body>

<h1>KMeans Customer Segmentation</h1>
<h3>Mall Customers Dataset (200 customers)</h3>
<hr>

<h2>Model Evaluation</h2>
<table border="1" cellpadding="5">
    <tr><td><b>Algorithm</b></td><td>KMeans</td></tr>
    <tr><td><b>Best K</b></td><td>{{ bundle.metrics.best_k }}</td></tr>
    <tr><td><b>Total Samples</b></td><td>{{ bundle.metrics.n_samples }}</td></tr>
    <tr><td><b>Inertia (WCSS)</b></td><td>{{ bundle.metrics.inertia }}</td></tr>
    <tr><td><b>Silhouette Score</b></td><td>{{ bundle.metrics.silhouette }}</td></tr>
    <tr><td><b>Calinski-Harabasz</b></td><td>{{ bundle.metrics.calinski_harabasz }}</td></tr>
    <tr><td><b>Davies-Bouldin</b></td><td>{{ bundle.metrics.davies_bouldin }}</td></tr>
</table>

<hr>

<h2>Elbow + Silhouette (K=2 to 10)</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>K</th><th>Inertia</th><th>Silhouette</th>
        <th>Calinski-Harabasz</th><th>Davies-Bouldin</th><th></th>
    </tr>
    {% for k, v in bundle.k_results.items() %}
    <tr>
        <td>{{ k }}</td>
        <td>{{ v.inertia }}</td>
        <td>{{ v.silhouette }}</td>
        <td>{{ v.calinski_harabasz }}</td>
        <td>{{ v.davies_bouldin }}</td>
        <td>{% if k|string == bundle.metrics.best_k|string %} BEST{% endif %}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h2>Cluster Centers (Original Scale)</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>Cluster</th><th>Gender (0=F,1=M)</th>
        <th>Age</th><th>Income (k$)</th><th>Spending Score</th>
    </tr>
    {% for cl, v in bundle.centers_original.items() %}
    <tr>
        <td>{{ cl }}</td>
        <td>{{ v["Gender"] }}</td>
        <td>{{ v["Age"] }}</td>
        <td>{{ v["Annual Income (k$)"] }}</td>
        <td>{{ v["Spending Score (1-100)"] }}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h2>Cluster Profiles</h2>
{% for p in bundle.profiles %}
<h3>Cluster {{ p.cluster }} â€” {{ p.name }}</h3>
<table border="1" cellpadding="5">
    <tr><td><b>Customers</b></td><td>{{ p.count }} ({{ p.pct }}%)</td></tr>
    <tr><td><b>Gender</b></td><td>{{ p.gender }}</td></tr>
    <tr><td><b>Avg Age</b></td><td>{{ p.means["Age"] }}</td></tr>
    <tr><td><b>Avg Income</b></td><td>{{ p.means["Annual Income (k$)"] }}k$</td></tr>
    <tr><td><b>Avg Spending</b></td><td>{{ p.means["Spending Score (1-100)"] }}</td></tr>
</table>
{% if p.high %}<p><b>HIGH:</b> {{ p.high|join(", ") }}</p>{% endif %}
{% if p.low %}<p><b>LOW:</b> {{ p.low|join(", ") }}</p>{% endif %}
<br>
{% endfor %}

<hr>

<h2>Retrain</h2>
<form action="/train" method="post">
    <button type="submit">Retrain KMeans</button>
</form>

<hr>

<h2>Predict New Customer</h2>
<form action="/predict" method="post">
    <table border="1" cellpadding="5">
        <tr>
            <td><b>Gender</b></td>
            <td><select name="Gender">
                <option value="Female">Female</option>
                <option value="Male">Male</option>
            </select></td>
        </tr>
        <tr><td><b>Age</b></td>
            <td><input type="number" name="Age" min="1" max="100" value="30" required></td></tr>
        <tr><td><b>Annual Income (k$)</b></td>
            <td><input type="number" name="Income" min="1" max="200" value="50" required></td></tr>
        <tr><td><b>Spending Score (1-100)</b></td>
            <td><input type="number" name="Spending" min="1" max="100" value="50" required></td></tr>
    </table>
    <br>
    <button type="submit">Predict Segment</button>
</form>

</body>
</html>